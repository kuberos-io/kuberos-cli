apiVersion: v1
kind: ApplicationDeployment
metadata:
  name: hello-world-humble-dev
  rosVersion: humble
  appVersion: dev-1
  targetFleet: bw1-fleet
  targetRobots: ['simbot-1']
  edgeResourceGroup: ['public'] # default

rosModules:
  - name: hello-world-talker
    image: <Container Registry>/ros2_basic_examples/hello_world:v1-param
    entrypoint: ["ros2 run examples_rclpy_minimal_publisher publisher_local_function"]

    preference: [onboard] # Preference for scheduler
    
    requirements: 
      latency: 50ms
      dynamicRescheduling: false
      privilege: true
      peripheral: ['ur-robot'] 
      nvidia: false # placeholder for the future
      containerRuntime: containerd/docker # placeholder for the future

    launchParameters: # Placeholder -> Not used in this example
      # args used in the launch file
      robot_ip: {UR_ROBOT.ROBOT_IP} # hardware specific parameters -> Uppercase
      ur_type: {UR_ROBOT.UR_TYPE}
      use_sim: {launch_parameters.use_sim} # custom setup -> Lowercase 
      use_rviz: {launch_parameters.use_rviz}

    # To make this module reusable, you shouldn't change the rosmodule description
    # To use custom configuration, you can define your parameters in rosParameters/staticFiles section. 
    # In KubeROS Abstraction: code / configuration / file are separated!
    rosParameters: 
      - name: minimal_publisher_params 
        valueFrom: minimal_publisher_params_customized
      - name: launch_parameters
        valueFrom: helloworld_launch_parameters    

    staticFiles: 
      - name: ml_weights_container
        requiredBindType: container 
        hostpath: /workspace/configs/ml_model_weights
        valueFrom: 

  - name: hello-world-listener
    image: <Container Registry>/ros2_basic_examples/hello_world:v0
    entrypoint: ["ros2 run examples_rclpy_minimal_subscriber subscriber_lambda"]

    preference: [edge, onboard] # Preference for scheduler
    requirements: 
      latency: 50ms
      dynamicRescheduling: false
      privilege: true
      nvidia: false # placeholder for the future
      containerRuntime: containerd/docker # placeholder for the future
      useBridge: true # after parser, the target cluster should be injected.
    
rosParameters:
  # custom parameters
  - name: helloworld_launch_parameters
    data:
      use_sim: false
      use_rviz: false

  - name: minimal_publisher_params_customized
    path: /workspace/kuberoscli/ros_deployment/config_files_hello_world/helloworld.yml
  

staticFiles: 
  # Placeholder, not included in this test version
  - name: ml_weights_for_mask_rcnn    
    # The file will be uploaded to the target cluster node
    bindMethod: container | upload | pv
    path: config_files/ml_model_weights.dummy
    hostpath: /workspace/config/weights
  - name: ml_weights_container 
    # Weights is package into a container and deployed along the rosmodule in the same pod. 
    container: 
      - image: <container image address> 
        pullSecret: <name of your credential in KubeROS database> 
  - name: claimed_pv
    # decoupled storage, for using in the edge and cloud. 
    # feature with low priority. 
