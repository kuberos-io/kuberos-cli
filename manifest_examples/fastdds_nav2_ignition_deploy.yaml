apiVersion: v1
kind: ApplicationDeployment
metadata:
  name: nav2-example
  rosVersion: humble
  appVersion: dev-1
  targetFleet: bw1-fleet
  targetRobots: ['simbot-1']
  edgeResourceGroup: ['public'] # default

rosModules:
  - name: simulated-robot
    image: metagoto/nav2_sim_humble:v0.1.0
    entrypoint: ["/entrypoint.sh x2goglx2 ros2 launch tb4_bringup turtlebot4_ignition.launch.py world:=maze slam:=true nav2:=true rviz:=true nav_to_pose:=true"]

    preference: [onboard] # Preference for scheduler

    requirements: 
      latency: 50ms
      dynamicRescheduling: false
      privilege: true
      peripheral: ['ur-robot'] 
      nvidia: false # placeholder for the future
      containerRuntime: containerd/docker # placeholder for the future

    launchParameters: # Placeholder -> Not used in this example
      # args used in the launch file
      # robot_ip: {UR_ROBOT.ROBOT_IP} # hardware specific parameters -> Uppercase
      # ur_type: {UR_ROBOT.UR_TYPE}
      # init_topic: {launch_parameters.init_topic} # custom setup -> Lowercase 

    # To make this module reusable, you shouldn't change the rosmodule description
    # To use custom configuration, you can define your parameters in rosParameters/staticFiles section. 
    # In KubeROS Abstraction: code / configuration / file are separated!
    rosParameters: 
      - name: launch-parameters
        type: key-value
        valueFrom: ign-parameters

  - name: robot-nav2-task
    image: metagoto/nav2_sim_humble:v0.1.0
    entrypoint: ["ros2 topic list"]

    preference: [onboard] # Preference for scheduler
    requirements: 
      nvidia: false # placeholder for the future
      containerRuntime: containerd/docker # placeholder for the future
      useBridge: false # after parser, the target cluster should be injected.
    
rosParamMap:
  # custom parameters
  - name: ign-parameters
    type: key-value
    data:
      IGN_PARTITION: 'sim'
      STARTX11: true
      NOVNC_ENABLE: true
      WINDOW_MANAGER_ENABLE: true
      RMW_IMPLEMENTATION: rmw_cyclonedds_cpp
      # ROS_DOMAIN_ID: '3'